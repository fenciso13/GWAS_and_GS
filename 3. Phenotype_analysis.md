Pre-treatments of phenotypes (BLUPs)

```{r}
## Parameters
  rm(list=ls())
  setwd("/Users/fenciso/Desktop/Thesis/GWAS_GS/r")
  phenoFile<-"/Users/fenciso/Desktop/Thesis/GWAS_GS/r/New_phenotype/new_scab_pheno.txt"
  hasHeader=T
  na.strings='NA'
  traitName<-'SCAB'
  logTransform=FALSE
  quant_var=FALSE

## 
  library(lme4)
  Y<-read.table(file=phenoFile,header=hasHeader,na.strings=na.strings,stringsAsFactors=F)

  ## Analysis by trait
   DATA=Y[!is.na(Y[,traitName]),]
   DATA$y=DATA[,traitName]
   DATA$y=scale(DATA$y, center=T,scale=T)
   DATA$YEAR_LINE<-paste( DATA$YEAR, DATA$LINE,sep='_')

   if(logTransform){ DATA$y=log(DATA$y+1+min(DATA$y)) }
   print(paste('Trait=',traitName,' Number of Records=',nrow(DATA)))
   
# Trait summary

   print(table(DATA$YEAR))
   #print(table(DATA$LINE))
   print(table(DATA$REP))

  if(quant_var){
   pdf(paste0(traitName,'_descriptive.pdf'))
   hist(DATA$y)
   boxplot(DATA$yc~DATA$YEAR,main=traitName)
   boxplot(DATA$yc~DATA$LINE,main=traitName)
   boxplot(DATA$yc~DATA$REP,main=traitName)
   dev.off()
  } else {
   pdf(paste0(traitName,'_descriptive.pdf'), height = 7)
   #barplot(table(DATA$YEAR,DATA$LINE))
   #spineplot(factor(DATA$SCAB)~factor(DATA$YEAR), col=terrain.colors(length(table(DATA$SCAB))), xlab="Year", ylab="Scab scale")
   mosaicplot(table(DATA$YEAR,DATA$SCAB), data=DATA, las=1, main="Scab data (Scale~Year)",xlab="Year", ylab="Scale",col=terrain.colors(length(table(DATA$SCAB))))

   
  # y=DATA$SCAB
   #x=DATA$LINE
   #tmp=tapply(X=y,INDEX=x,FUN=media) ## or media
   #str(tmp)
   #tmp=tmp[order(tmp)]
   #y=y[index]
   #x=x[index]
   #boxplot(y~x)
   #spineplot(factor(DATA$LINE)~factor(DATA$YEAR))
   
   dev.off()
 }
   myFormula<-formula(paste0("y~factor(YEAR)+(1|LINE)+(1|YEAR_LINE)"))
   fm<-lmer(myFormula,data=DATA)  
   print(summary(fm))
   TMP<-ranef(fm)$LINE
   blups<-TMP[,1]
   names(blups)<-rownames(TMP)
   save(blups,file=paste0(traitName,'_blups.RData'))
```
[Back to index](https://github.com/fenciso13/Potato_MSU/blob/master/index.md)
